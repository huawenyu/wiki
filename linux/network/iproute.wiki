---
layout: post
title:  "network: ip-tools"
date:   2014-02-16 13:31:01 +0800
categories: linux
tags: network
---

* content
{:toc}


# Deprecated Linux networking commands and their replacements

In my article detailing the command line utilities available for configuring and troubleshooting network properties on Windows and Linux, I mentioned some Linux tools that, while still
included and functional in many Linux distributions, are actually considered deprecated and therefore should be phased out in favor of more modern replacements.

Specifically, the deprecated Linux networking commands in question are: arp, ifconfig,Â iptunnel, iwconfig, nameif, netstat, and route. These programs (except iwconfig) are included in
the net-tools package that has been unmaintained for years. The functionality provided by several of these utilities has been reproduced and improved in the new iproute2 suite, primarily
by using its new ip command. The iproute2 software code is available from Kernel.org. Iproute2 documentation is available from the Linux Foundation and PolicyRouting.org.

+-------------------------------------------------------------------------------------------------------------------+
| Deprecated command |                                    Replacement command(s)                                    |
|--------------------+----------------------------------------------------------------------------------------------|
|arp                 |ip n (ip neighbor)                                                                            |
|--------------------+----------------------------------------------------------------------------------------------|
|ifconfig            |ip a (ip addr), ip link, ip -s (ip -stats)                                                    |
|--------------------+----------------------------------------------------------------------------------------------|
|iptunnel            |ip tunnel                                                                                     |
|--------------------+----------------------------------------------------------------------------------------------|
|iwconfig            |iw                                                                                            |
|--------------------+----------------------------------------------------------------------------------------------|
|nameif              |ip link, ifrename                                                                             |
|--------------------+----------------------------------------------------------------------------------------------|
|netstat             |ss, ip route (for netstat-r), ip -s link (for netstat -i), ip maddr (for netstat-g)           |
|--------------------+----------------------------------------------------------------------------------------------|
|route               |ip r (ip route)                                                                               |
+-------------------------------------------------------------------------------------------------------------------+

.
Now let's take a closer look at these deprecated commands and their replacements.

This article will not focus on iproute2 or the ip command in detail; instead it will simply give one-to-one mappings between the deprecated commands and their new counterparts. For
replacement commands that are listed as 'not apparent', please contact me if you know otherwise.

Jump to:

  * Arp
  * Ifconfig
  * Iptunnel
  * Iwconfig
  * Nameif
  * Netstat
  * Route
  * Discussion
  * Recommended reading

Please note that nslookup and dig are covered separately here.

## Arp

+-------------------------------------------------------------------------------------------------------------------+
|                               Deprecated arp commands                               |         Replacement         |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -a [host] or --all [host]                                                        |                             |
|.                                                                                    |ip n (or ip neighbor), or ip |
|Shows the entries of the specified hostname <-> IP address. If the [host] parameter  |n show                       |
|is not used, all entries will be displayed.                                          |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|                                                                                     |ip n del [ip_addr] (this     |
|arp -d [ip_addr] or --delete [ip_addr]                                               |"invalidates" neighbor       |
|.                                                                                    |entries)                     |
|Removes the ARP cache entry for the specified host.                                  |.                            |
|                                                                                     |ip n f [ip_addr] (or ip n    |
|                                                                                     |flush [ip_addr])             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -D or --use-device                                                               |                             |
|.                                                                                    |Not apparent                 |
|Uses the hardware address associated with the specified interface.                   |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -e                                                                               |                             |
|.                                                                                    |Not apparent                 |
|Shows the entries in default (Linux) style.                                          |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -f [filename] or --file [filename]                                               |                             |
|.                                                                                    |Not apparent                 |
|Similar to the -s option, only this time the address info is taken from the file that|                             |
|[filename] set up. If no [filename] is specified, /etc/ethers is used as default.    |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -H or --hw-type [type] or -t [type]                                              |                             |
|.                                                                                    |                             |
|When setting or reading the ARP cache, this optional parameter tells arp which class |Not apparent                 |
|of entries it should check for. The default value of this parameter is ether (i.e.   |                             |
|hardware code 0x01 for IEEE 802.3 10Mbps Ethernet).                                  |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -i [int] or --device [int]                                                       |                             |
|.                                                                                    |                             |
|Selects an interface. When dumping the ARP cache only entries matching the specified |ip n [add | chg | del | repl]|
|interface will be printed. For example, arp -i eth0 -s 10.21.31.41 A321.ABCF.321A    |dev [name]                   |
|creates a static ARP entry associating IP address 10.21.31.41 with MAC address       |                             |
|A321.ABCF.321A on eth0.                                                              |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -n or --numeric                                                                  |                             |
|.                                                                                    |Not apparent                 |
|Shows IP addresses instead of trying to determine domain names.                      |                             |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -s [ip_addr] [hw_addr] or --set [ip_addr]                                        |ip n add [ip_addr] lladdr    |
|.                                                                                    |[mac_address] dev [device]   |
|Manually creates a static ARP address mapping entry for host [ip_addr] with the      |nud [nud_state] (see example |
|hardware address set to [hw_addr].                                                   |below)                       |
|-------------------------------------------------------------------------------------+-----------------------------|
|arp -v                                                                               |                             |
|.                                                                                    |ip -s n (or ip -stats n)     |
|Uses verbose mode to provide more details.                                           |                             |
+-------------------------------------------------------------------------------------------------------------------+

.
Some ip neighbor examples are as follows:

    # ip n del 10.1.2.3 dev eth0

Invalidates the ARP cache entry for host 10.1.2.3 on device eth0.

    # ip neighbor show dev eth0

Shows the ARP cache for interface eth0.

    # ip n add 10.1.2.3 lladdr 1:2:3:4:5:6 dev eth0 nud perm

Adds a "permanent" ARP cache entry for host 10.1.2.3 device eth0. The Neighbor Unreachability Detection (nud) state can be one of the following:

  * noarp -- entry is valid. No attempts to validate this entry will be made but it can be removed when its lifetime expires.
  * permanent -- entry is valid forever and can be only be removed administratively.
  * reachable -- entry is valid until the reachability timeout expires.
  * stale -- entry is valid but suspicious.

## Ifconfig

+-------------------------------------------------------------------------------------------------------------------+
|                        Deprecated ifconfig commands                        |             Replacement              |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig                                                                    |                                      |
|.                                                                           |ip a (or ip addr)                     |
|Displays details on all network interfaces.                                 |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface]                                                        |                                      |
|.                                                                           |                                      |
|The name of the interface. This is usually a driver name followed by a unit |ip a show dev [interface]             |
|number; for example, eth0 for the first Ethernet interface. Eth0 will       |                                      |
|usually be a PC's primary network interface card (NIC).                     |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [address_family]                                                   |                                      |
|.                                                                           |ip -f [family] a                      |
|To enable the interpretation of differing naming schemes used by various    |.                                     |
|protocols, [address_family] is used for decoding and displaying all protocol|[family] can be inet (IPv4), inet6    |
|addresses. Currently supported address families include inet (TCP/IP,       |(IPv6), or link. Additionally, -4 = -f|
|default), inet6 (IPv6), ax25 (AMPR Packet Radio), ddp (Appletalk Phase 2),  |inet and -6 = -f inet6.               |
|ipx (Novell IPX) and netrom (AMPR Packet radio).                            |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] add [address/prefixlength                              |ip a add [ip_addr/mask] dev           |
|.                                                                           |[interface]                           |
|Adds an IPv6 address to the [interface].                                    |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] address [address]                                      |ip a add [ip_addr/mask] dev           |
|.                                                                           |[interface]                           |
|Assigns the specified IP [address] to the specified [interface].            |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] allmulti or -allmulti                                  |ip mr iif [name] or ip mroute iif     |
|.                                                                           |[name], where [name] is the interface |
|Enables or disables all-multicast mode. If selected, all multicast packets  |on which multicast packets are        |
|on the network will be received by the [interface] specified. This enables  |received.                             |
|or disables the sending of incoming frames to the kernel's network layer.   |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] arp or -arp                                            |                                      |
|.                                                                           |ip link set arp on or arp off         |
|Enables or disables the use of the ARP protocol on this [interface].        |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] broadcast [address]                                    |ip a add broadcast [ip_address]       |
|.                                                                           |.                                     |
|Specifies the address to use to use for broadcast transmissions. By default,|ip link set dev [interface] broadcast |
|the broadcast address for a subnet is the IP address with all ones in the   |[mac_address] (sets the link layer    |
|host portion of the subnet address (i.e., a.b.c.255 for a /24 subnet).      |broadcast address)                    |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] del [address/prefixlength]                             |ip a del [ipv6_addr or ipv4_addr] dev |
|.                                                                           |[interface]                           |
|Removes an IPv6 address from the [interface], such as eth0.                 |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] down                                                   |                                      |
|.                                                                           |ip link set dev [interface] down      |
|Disables the [interface], such as eth0.                                     |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] hw [class] [address]                                   |                                      |
|.                                                                           |                                      |
|Sets the hardware (MAC) address of this [interface], if the device driver   |ip link set dev [interface] address   |
|supports this operation. The keyword must be followed by the name of the    |[mac_addr]                            |
|hardware [class] and the printable ASCII equivalent of the hardware address.|                                      |
|Hardware classes currently supported include ether (Ethernet), ax25 (AMPR   |                                      |
|AX.25), ARCnet and netrom (AMPR NET/ROM).                                   |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] io_addr [address]                                      |                                      |
|.                                                                           |Not apparent; possibly ethtool.       |
|Sets the start [address] in I/O space for this device.                      |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] irq [address]                                          |                                      |
|.                                                                           |Not apparent; possibly ethtool.       |
|Sets the interrupt line used by the network interface.                      |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] mem_start [address]                                    |                                      |
|.                                                                           |Not apparent; possibly ethtool.       |
|Sets the start address for shared memory of the interface.                  |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] media [type]                                           |                                      |
|.                                                                           |                                      |
|Sets physical port or medium type. Examples of [type] are 10baseT, 10base2, |Not apparent; possibly ethtool.       |
|and AUI. A [type] value of auto will tell the interface driver to           |                                      |
|automatically determine the media type (driver support for this command     |                                      |
|varies).                                                                    |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] mtu [n]                                                |                                      |
|.                                                                           |ip link set dev [interface] mtu [n]   |
|Sets the Maximum Transfer Unit (MTU) of an interface to [n].                |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] multicast                                              |                                      |
|.                                                                           |ip link set dev [interface] multicast |
|Sets the multicast flag on the interface (should not normally be needed as  |on or off                             |
|the drivers set the flag correctly themselves).                             |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] netmask [mask_address]                                 |                                      |
|.                                                                           |                                      |
|Sets the subnet mask (not the IP address) for this [interface]. This value  |Not apparent                          |
|defaults to the standard Class A, B, or C subnet masks (based on the        |                                      |
|interface IP address) but can be changed with this command.                 |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|                                                                            |not apparent; possiblyÂ ipppd [device].|
|ifconfig [interface] pointopoint or -pointopoint                            |The command ip a add peer [address]   |
|.                                                                           |specifies the address of the remote   |
|Enables or disables point-to-point mode on this [interface].                |endpoint for point-to-point           |
|                                                                            |interfaces.                           |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] promisc or -promisc                                    |ip link set dev [interface] promisc on|
|.                                                                           |or off                                |
|Enables or disables promiscuous mode on the [interface].                    |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] txquelen [n]                                           |                                      |
|.                                                                           |ip link set dev [interface] txqueuelen|
|Sets the transmit queue length on the [interface]. Smaller values are       |[n] or txqlen [n]                     |
|recommended for connections with high latency (i.e., dial-up modems, ISDN,  |                                      |
|etc).                                                                       |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] tunnel [address]                                       |                                      |
|.                                                                           |ip tunnel mode sit (other possible    |
|Creates a Simple Internet Transition (IPv6-in-IPv4) device which tunnels to |modes are ipip and gre).              |
|the IPv4 [address] provided.                                                |                                      |
|----------------------------------------------------------------------------+--------------------------------------|
|ifconfig [interface] up                                                     |                                      |
|.                                                                           |ip link set [interface] up            |
|Activates (enables) the [interface] specified.                              |                                      |
+-------------------------------------------------------------------------------------------------------------------+

.
Some examples illustrating the ip command are as follows; using the table above you should be able to figure out what they do.

    # ip link show dev eth0
    # ip a add 10.11.12.13/8 dev eth0
    # ip link set dev eth0 up
    # ip link set dev eth0 mtu 1500
    # ip link set dev eth0 address 00:70:b7:d6:cd:ef

## Iptunnel

+-------------------------------------------------------------------------------------------------------------------+
|          Deprecated iptunnel commands          |                           Replacement                            |
|------------------------------------------------+------------------------------------------------------------------|
|                                                |ip tunnel a or add                                                |
|iptunnel [add | change | del | show]            |ip tunnel chg or change                                           |
|                                                |ip tunnel d or del                                                |
|                                                |ip tunnel ls or show                                              |
|------------------------------------------------+------------------------------------------------------------------|
|iptunnel addÂ [name] [mode {ipip | gre | sit} ]  |ip tunnel add [name] [mode {ipip | gre | sit | isatap | ip6in6 |  |
|remote [remote_addr] local [local_addr]         |ipip6 | any }] remote [remote_addr] local [local_addr]            |
|------------------------------------------------+------------------------------------------------------------------|
|iptunnel -V or --version                        |not apparent                                                      |
+-------------------------------------------------------------------------------------------------------------------+

.
The syntax between iptunnel and ip tunnel is very similar as these examples show.

    # [iptunnel | ip tunnel] add ipip-tunl1 mode ipip remote 83.240.67.86 (ipip-tunl1 is the name of the tunnel, 83.240.67.86 is the IP address of the remote endpoint).
    # [iptunnel | ip tunnel] add ipi-tunl2 mode ipip remote 104.137.4.160 local 104.137.4.150 ttl 1
    #Â [iptunnel | ip tunnel] add gre-tunl1 mode gre remote 192.168.22.17 local 192.168.10.21 ttl 255

Iptunnel is covered in more depth here.

## Iwconfig

Iwconfig's successor, iw, is still in development. Official documentation for iw is available here and here.

+-------------------------------------------------------------------------------------------------------------------+
|                                  Deprecated iwconfig commands                                  |   Replacement    |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig                                                                                        |                  |
|.                                                                                               |                  |
|Displays basic details about wireless interfaces, such as supported protocols (802.11a/b/g/n),  |iw dev [interface]|
|Extended Service Set ID (ESSID), mode, and access point. To view these details about a          |link              |
|particular interface, use iwconfig [interface] where the interface is the device name, such as  |                  |
|wlan0.                                                                                          |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] ap [address]                                                               |                  |
|.                                                                                               |                  |
|Forces the wireless adapter to register with the access point given by the [address], if        |Not apparent      |
|possible. This address is the cell identity of the access point (as reported by wireless        |                  |
|scanning) which may be different from its MAC address.                                          |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig commit                                                                                 |                  |
|.                                                                                               |                  |
|Some wireless adapters may not apply changes immediately (they may wait to aggregate the        |Not apparent      |
|changes, or apply them only when the card is brought up via ifconfig). This command (when       |                  |
|available) forces the adapter to immediately apply all pending changes.                         |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] essid [name]                                                               |                  |
|.                                                                                               |iw [interface]    |
|Connects to the WLAN with the ESSID [name] provided. With some wireless adapters, you can       |connect [name]    |
|disable the ESSID checking (ESSID promiscuous) with off or any (and on to re-enable it).        |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] frag [num]                                                                 |                  |
|.                                                                                               |                  |
|Sets the maximum fragment size which is always lower than the maximum packet size. This         |Not apparent      |
|parameter may also control Frame Bursting available on some wireless adapters (the ability to   |                  |
|send multiple IP packets together). This mechanism would be enabled if the fragment size is     |                  |
|larger than the maximum packet size. Other valid frag parameters to auto, on, and off.          |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] [freq | channel]                                                           |iw dev [interface]|
|.                                                                                               |set freq [freq]   |
|Sets the operating frequency or channel on the wireless device. A value below 1000 indicates a  |[HT20|HT40+|HT40-]|
|channel number, a value greater than 1000 is a frequency in Hz. You can append the suffix k, M  |.                 |
|or G to the value (for example, "2.46G" for 2.46 GHz frequency). You may also use off or auto to|iw dev [interface]|
|let the adapter pick up the best channel (when supported).                                      |set channel [chan]|
|                                                                                                |[HT20|HT40+|HT40-]|
|------------------------------------------------------------------------------------------------+------------------|
|                                                                                                |iw [interface]    |
|iwconfig [interface] key [key] [mode] [on | off]                                                |connect [name]    |
|.                                                                                               |keys [key] (for   |
|To set the current encryption [key], just enter the key in hex digits as XXXX-XXXX-XXXX-XXXX or |WEP)              |
|XXXXXXXX. You can also enter the key as an ASCII string by using the s: prefix. On and off re=  |.                 |
|enable and disable encryption. The security mode may be open or restricted, and its meaning     |To connect to an  |
|depends on the card used. With most cards, in open mode no authentication is used and the card  |AP with WPA or    |
|may also accept non-encrypted sessions, whereas in restricted mode only encrypted sessions are  |WPA2 encryption,  |
|accepted and the card will use authentication if available.                                     |you must use      |
|                                                                                                |wpa_supplicant.   |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] mode [mode]                                                                |                  |
|.                                                                                               |                  |
|Sets the operating mode of the wireless device. The [mode] can be Ad-Hoc, Auto, Managed, Master,|                  |
|Monitor, Repeater, or Secondary.                                                                |                  |
|.                                                                                               |                  |
|Ad-Hoc: the network is composed of only one cell and without an access point.                   |Not apparent      |
|Managed: the wireless node connects to a network composed of many access points, with roaming.  |                  |
|Master: the wireless node is the synchronization master, or it acts as an access point.         |                  |
|Monitor: the wireless node is not associated with any cell and passively monitors all packets on|                  |
|the frequency.                                                                                  |                  |
|Repeater: the wireless node forwards packets between other wireless nodes.                      |                  |
|Secondary: the wireless node acts as a backup master/repeater.                                  |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] modu [modulation]                                                          |                  |
|.                                                                                               |                  |
|Forces the wireless adapter to use a specific set of modulations. Modern adapters support       |Not apparent      |
|various modulations, such as 802.11b or 802.11g. The list of available modulations depends on   |                  |
|the adapter/driver and can be displayed using iwlist modulation. Some options are 11g, CCK OFDMa|                  |
|, and auto.                                                                                     |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] nick [name]                                                                |                  |
|.                                                                                               |Not apparent      |
|Sets the nick name (or station name).                                                           |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] nwid [name]                                                                |                  |
|.                                                                                               |                  |
|Sets the Network ID for the WLAN. This parameter is only used for pre-802.11 hardware as the    |Not apparent      |
|802.11 protocol uses the ESSID and access point address for this function. With some wireless   |                  |
|adapters, you can disable the Network ID checking (NWID promiscuous) with off (and on to        |                  |
|re-enable it).                                                                                  |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] power [option]                                                             |                  |
|iwconfig [interface] power min | max [secondsu | secondsm]                                      |                  |
|iwconfig [interface] power mode [mode]                                                          |Not apparent; some|
|iwconfig [interface] power on | off                                                             |power commands    |
|.                                                                                               |are:              |
|Configures the power management scheme and mode. Valid [options] are: period [value] (sets the  |.                 |
|period between wake ups), timeout [value] (sets the timeout before going back to sleep), saving |iw dev [interface]|
|[value] (sets the generic level of power saving).                                               |set power_save on |
|The min and max modifiers are in seconds by default, but append the suffices m or u to specify  |.                 |
|values in milliseconds or microseconds.                                                         |iw dev [interface]|
|Valid [mode] options are: all (receive all packets), unicast (receive unicast packets only,     |get power_save    |
|discard multicast and broadcast) and multicast (receive multicast and broadcast only, discard   |                  |
|unicast packets).                                                                               |                  |
|On and off re-enable or disable power management.                                               |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] rate/bit [rate]                                                            |                  |
|.                                                                                               |                  |
|Sets the bit rate in bits per second for cards supporting multiple bit rates. The bit-rate is   |iw [interface] set|
|the speed at which bits are transmitted over the medium, the user speed of the link is lower due|bitrates          |
|to medium sharing and various overhead.Suffixes k, M or G can be added to the numeric [rate]    |legacy-2.4 12 18  |
|(decimal multiplier : 10^3, 10^6 and 10^9 b/s), or add '0' for enough. The [rate] can also be   |24                |
|auto to select automatic bit-rate mode (fallback to lower rate on noisy channels), or fixed to  |                  |
|revert back to fixed setting. If you specify a bit-rate numeric value and append auto, the      |                  |
|driver will use all bit-rates lower and equal than this value.                                  |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] retry [option] [value]                                                     |                  |
|.                                                                                               |                  |
|To set the maximum number of retries (MAC retransmissions), enter limit [value]. To set the     |Not apparent      |
|maximum length of time the MAC should retry, enter lifetime [value]. By default, this value is  |                  |
|in seconds; append the suffices m or u to specify values in milliseconds or microseconds. You   |                  |
|can also add the short, long, min and max modifiers.                                            |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] rts [threshold]                                                            |                  |
|.                                                                                               |                  |
|Sets the size of the smallest packet for which the node sends RTS; a value equal to the maximum |Not apparent      |
|packet size disables the mechanism. You may also set the threshold parameter to auto, fixed or  |                  |
|off.                                                                                            |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig [interface] sens [threshold]                                                           |                  |
|.                                                                                               |                  |
|Sets the sensitivity threshold (defines how sensitive the wireless adapter is to poor operating |Not apparent      |
|conditions such as low signal, signal interference, etc). Modern adapter designs seem to control|                  |
|these thresholds automatically.                                                                 |                  |
|------------------------------------------------------------------------------------------------+------------------|
|                                                                                                |iw dev [interface]|
|iwconfig [interface] txpower [value]                                                            |set txpower [auto |
|.                                                                                               || fixed | |limit] |
|For adapters supporting multiple transmit powers, this sets the transmit power in dBm. If W is  |[tx power in mBm] |
|the power in Watt, the power in dBm is P = 30 + 10.log(W). If the [value] is postfixed by mW, it|.                 |
|will be automatically converted to dBm. In addition, on and off enable and disable the radio,   |iw phy [phyname]  |
|and auto and fixed enable and disable power control (if those features are available).          |set txpower [auto |
|                                                                                                || fixed | limit]  |
|                                                                                                |[tx power in mBm] |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig --help                                                                                 |                  |
|.                                                                                               |iw help           |
|Displays the iwconfig help message.                                                             |                  |
|------------------------------------------------------------------------------------------------+------------------|
|iwconfig --version                                                                              |                  |
|.                                                                                               |iw --version      |
|Displays the version of iwconfig installed.                                                     |                  |
+-------------------------------------------------------------------------------------------------------------------+

.
Some examples of the iw command syntax are as follows.

    # iw dev wlan0 link
    # iw wlan0 connect CoffeeShopWLAN
    # iw wlan0 connect HomeWLAN keys 0:abcde d:1:0011223344 (for WEP)

## Nameif

+-------------------------------------------------------------------------------------------------------------------+
|                                  Deprecated nameif commands                                  |    Replacement     |
|----------------------------------------------------------------------------------------------+--------------------|
|                                                                                              |ip link set dev     |
|nameif [name] [mac_address]                                                                   |[interface] name    |
|.                                                                                             |[name]              |
|If no name and MAC address are provided, it attempts to read addresses from /etc/mactab. Each |.                   |
|line of mactab should contain an interface name and MAC address (or comments starting with #).|ifrename -i         |
|                                                                                              |[interface] -n      |
|                                                                                              |[newname]           |
|----------------------------------------------------------------------------------------------+--------------------|
|nameif -c [config_file]                                                                       |ifrename -c         |
|.                                                                                             |[config_file]       |
|Reads from [config_file] instead of /etc/mactab.                                              |                    |
|----------------------------------------------------------------------------------------------+--------------------|
|nameif -s                                                                                     |                    |
|.                                                                                             |Not apparent        |
|Error messages are sent to the syslog.                                                        |                    |
+-------------------------------------------------------------------------------------------------------------------+

## Netstat

+-------------------------------------------------------------------------------------------------------------------+
|                                   Deprecated netstat commands                                    |  Replacement   |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -a or --all                                                                               |                |
|.                                                                                                 |ss -a or --all  |
|Shows both listening and non-listening sockets.                                                   |                |
|--------------------------------------------------------------------------------------------------+----------------|
|                                                                                                  |ss -f [family]  |
|netstat -A [family] or --protocol=[family]                                                        |or --family=     |
|.                                                                                                 |[family]        |
|Specifies the address families for which connections are to be shown. [family] is a comma         |.               |
|separated list of address family keywords like inet, unix, ipx, ax25, netrom, and ddp. This has   |Families: unix, |
|the same effect as using the --inet, --unix (-x), --ipx, --ax25, --netrom, and --ddp options.     |inet, inet6,    |
|                                                                                                  |link, netlink.  |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -c or --continuous                                                                        |                |
|.                                                                                                 |Not apparent    |
|Configures netstat to refresh the displayed information every second until stopped.               |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -C                                                                                        |ip route list   |
|.                                                                                                 |cache           |
|Prints routing information from the route cache.                                                  |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -e or --extend                                                                            |ss -e or        |
|.                                                                                                 |--extended      |
|Displays an increased level of detail. Can be entered as twice (as --ee) for maximum details.     |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -F                                                                                        |                |
|.                                                                                                 |Not apparent    |
|Prints routing information from the forward information database (FIB).                           |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -g or --groups                                                                            |ip maddr, ip    |
|.                                                                                                 |maddr show      |
|Displays multicast group membership information for IPv4 and IPv6.                                |[interface]     |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -i or --interface=[name]                                                                  |                |
|.                                                                                                 |ip -s link      |
|Displays a table of all network interfaces, or the specified [name].                              |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -l or --listening                                                                         |ss -l or        |
|.                                                                                                 |--listening     |
|Shows only listening sockets (which are omitted by netstat be default).                           |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -M or --masquerade                                                                        |                |
|.                                                                                                 |Not apparent    |
|Displays a list of masqueraded connections (connections being altered by Network Address          |                |
|Translation).                                                                                     |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -n or --numeric                                                                           |                |
|.                                                                                                 |ss -n or        |
|Show numerical addresses instead of trying to determine symbolic host, port or user names (skips  |--numeric       |
|DNS translation).                                                                                 |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat --numeric-hosts                                                                           |                |
|.                                                                                                 |Not apparent    |
|Shows numerical host addresses but does not affect the resolution of port or user names.          |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat --numeric ports                                                                           |                |
|.                                                                                                 |Not apparent    |
|Shows numerical port numbers but does not affect the resolution of host or user names.            |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat --numeric-users                                                                           |                |
|.                                                                                                 |Not apparent    |
|Shows numerical user IDs but does not affect the resolution of host or port names.                |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -N or --symbolic                                                                          |                |
|.                                                                                                 |ss -r or        |
|Displays the symbolic host, port, or user names instead of numerical representations. Netstat does|--resolve       |
|this by default.                                                                                  |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -o or --timers                                                                            |ss -o or        |
|.                                                                                                 |--options       |
|Includes information related to networking timers.                                                |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -p or --program                                                                           |                |
|.                                                                                                 |ss -p           |
|Shows the process ID (PID) and name of the program to which each socket belongs.                  |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -r or --route                                                                             |ip route, ip    |
|.                                                                                                 |route show all  |
|Shows the kernel routing tables.                                                                  |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -s or --statistics                                                                        |                |
|.                                                                                                 |ss -s           |
|Displays summary statistics for each protocol.                                                    |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -t or --tcp                                                                               |                |
|.                                                                                                 |ss -t or --tcp  |
|Filters results to display TCP only.                                                              |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -T or --notrim                                                                            |                |
|.                                                                                                 |Not apparent    |
|Stops trimming long addresses.                                                                    |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -u or --udp                                                                               |                |
|.                                                                                                 |ss -u or --udp  |
|Filters results to display UDP only.                                                              |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -v or --verbose                                                                           |                |
|.                                                                                                 |Not apparent    |
|Produces verbose output.                                                                          |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -w or --raw                                                                               |                |
|.                                                                                                 |ss-w or --raw   |
|Filter results to display raw sockets only.                                                       |                |
|--------------------------------------------------------------------------------------------------+----------------|
|netstat -Z or --context                                                                           |                |
|.                                                                                                 |                |
|Prints the SELinux context if SELinux is enabled. On hosts running SELinux, all processes and     |Not apparent    |
|files are labeled in a way that represents security-relevant information. This information is     |                |
|called the SELinux context.                                                                       |                |
+-------------------------------------------------------------------------------------------------------------------+

## Route

+-------------------------------------------------------------------------------------------------------------------+
|                     Deprecated route commands                      |                 Replacement                  |
|--------------------------------------------------------------------+----------------------------------------------|
|route                                                               |                                              |
|.                                                                   |ip route                                      |
|Displays the host's routing tables.                                 |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -A [family] [add] or route --[family] [add]                   |ip -f [family] route                          |
|.                                                                   |.                                             |
|Uses the specified address family with add or del. Valid families   |[family] can be inet (IP), inet6 (IPv6), or   |
|are inet (DARPA Internet), inet6 (IPv6), ax25 (AMPR AX.25), netrom  |link. Additionally, -4 = -f inet and -6 = -f  |
|(AMPR NET/ROM), ipx (Novell IPX), ddp (Appletalk DDP), and x25      |inet6.                                        |
|(CCITT X.25).                                                       |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -C or --cache                                                 |                                              |
|.                                                                   |Not apparent; ip route show cache dumps the   |
|Operates on the kernel's routing cache instead of the forwarding    |routing cache.                                |
|information base (FIB) routing table.                               |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -e or -ee                                                     |                                              |
|.                                                                   |                                              |
|Uses the netstat-r format to display the routing table. -ee will    |ip route show                                 |
|generate a very long line with all parameters from the routing      |                                              |
|table.                                                              |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -F or --fib                                                   |                                              |
|.                                                                   |Not apparent                                  |
|Operates on the kernel's Forwarding Information Base (FIB) routing  |                                              |
|table (default behavior).                                           |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -h or --help                                                  |                                              |
|.                                                                   |ip route help                                 |
|Prints the help message.                                            |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -n                                                            |                                              |
|.                                                                   |Not apparent                                  |
|Shows numerical IP addresses and bypass host name resolution.       |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -v or --verbose                                               |                                              |
|.                                                                   |ip -s route                                   |
|Enables verbose command output.                                     |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route -V or --version                                               |                                              |
|.                                                                   |ip -V                                         |
|Dispays the version of net-tools and the route command.             |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route add or del                                                    |ip route [add | chg | repl | del] [ip_addr]   |
|.                                                                   |via [ip_addr]                                 |
|Adds or delete a route in the routing table.                        |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] dev [interface]                                  |                                              |
|.                                                                   |ip routeÂ [add | chg | repl | del] dev         |
|Associates a route with a specific device. If dev [interface] is the|[interface]                                   |
|last option on the command line, the word dev may be omitted.       |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] [default] gw [gw]                                |                                              |
|.                                                                   |ip route add default via [gw]                 |
|Routes packets through the specified gateway IP address.            |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] -host                                            |                                              |
|.                                                                   |Not apparent                                  |
|Specifies that the target is a host (not a network).                |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] -irtt [n]                                        |                                              |
|.                                                                   |Not apparent; ip route [add | chg | repl |    |
|Sets the initial round trip time (IRTT) for TCP connections over    |del] rtt [number] sets the RTT estimate;      |
|this route to [n] milliseconds (1-12000). This is typically only    |rttvar [number] sets the initial RTT variance |
|used on AX.25 networks. If omitted the RFC 1122 default of 300ms is |estimate.                                     |
|used.                                                               |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] -net                                             |                                              |
|.                                                                   |Not apparent                                  |
|Specifies that the target is a network (not a host).                |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] [-host or -net] netmask [mask]                   |                                              |
|.                                                                   |Not apparent                                  |
|Sets the subnet [mask].                                             |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] metric [n]                                       |                                              |
|.                                                                   |ip route [add | chg | repl | del] metric      |
|Sets the metric field in the routing table (used by routing daemons)|[number] or preference [number]               |
|to the value of [n].                                                |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] mod, dyn, or reinstate                           |                                              |
|.                                                                   |Not apparent                                  |
|Install a dynamic or modified route. These flags are for diagnostic |                                              |
|purposes, and are generally only set by routing daemons.            |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] mss [bytes]                                      |ip route [add | chg | repl | del] advmss      |
|.                                                                   |[number] (the MSS to advertise to these       |
|Sets the TCP Maximum Segment Size (MSS) for connections over this   |destinations when establishing TCP            |
|route to the number of [bytes] specified.                           |connections).                                 |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] reject                                           |                                              |
|.                                                                   |                                              |
|Installs a blocking route, which will force a route lookup to fail. |ip route add prohibit [network_addr]          |
|This is used to mask out networks before using the default route.   |                                              |
|This is not intended to provide firewall functionality.             |                                              |
|--------------------------------------------------------------------+----------------------------------------------|
|route [add or del] window [n]                                       |                                              |
|.                                                                   |                                              |
|Set the TCP window size for connections over this route to the value|ip route [add | chg | repl | del] window [W]  |
|of [n] bytes. This is typically only used on AX.25 networks and with|                                              |
|drivers unable to handle back-to-back frames.                       |                                              |
+-------------------------------------------------------------------------------------------------------------------+

Some examples of ip route command syntax are as follows.

    # ip route add 10.23.30.0/24 via 192.168.8.50
    # ip route del 10.28.0.0/16 via 192.168.10.50 dev eth0
    # ip route chg default via 192.168.25.110 dev eth1

    (shows the interface and gateway that would be used to reach a remote host. This command would be especially useful for troubleshooting routing issues on
    hosts with large routing tables and/or with multiple network interfaces).
    # ip route get [ip_address]


# Quick Start

## ip tools

    # ip link show
    # ip link set dev eth0 up
    # ip addr show dev lan
    # ip addr flush dev lan                     #æ¸ç©ºç½å¡çææipå°å
    # ip addr add 192.168.2.77/24 dev lan       #æ·»å ip
    # ip neigh show                             #æ¾ç¤ºipä¸macå¯¹åºå³ç³»
    # ip neigh flush dev lan
    # ip route
    # ip route add 192.168.2.0/24 via 192.168.1.1 dev1234
    # ip route change default via 10.10.10.30 dev wan
    # traceroute www.google.com

## ss

    $ ss -t4 state established           <<<< To display all Ipv4 tcp sockets that are in "connected" state.

    ### Since sockets remain in such states syn-sent, syn-recv for a very short time.
    ###   It would be ideal to use the watch command to detect such socket states in real time.
    $ watch -n 1 "ss -t4 state syn-sent"

    $ ss -at '( dport = :ssh or sport = :ssh )'    <<< Display all socket connections with source or destination port of ssh.
    $ ss -nt '( dst :443 or dst :80 )'   <<< Option -n donnot resolve hostname|domain-name
    <OR> $ ss -nt dst :443 or dst :80    <<< Sockets with destination port 443 or 80
    $ ss -nt dst 74.125.236.178          <<< Filter by address
    $ ss -nt dst 74.125.236.178/16       <<< CIDR notation is also supported
    $ ss -nt dst 74.125.236.178:80       <<< Address and Port combined

## netstat

    # netstat -a        <List All Ports (both listening and non listening ports)>
    # netstat -l        <Active Internet connections>
    # netstat -s        <Show statistics for all ports>
    # netstat -pt       <Show the PID/Program Name>

# netstat

## command of `netstat`

### (-a) List ports by protocol

    # netstat -a | more <---List All Ports (both listening and non listening ports)
    # netstat -at       <---List all tcp ports
    # netstat -au       <---List all udp ports

### (-l) List by state=Listening

    # netstat -l
    # netstat -lt
    # netstat -lu       <Active Internet connections>
    # netstat -lx       <Active UNIX domain sockets>

### (-s) Show the statistics for each protocol

    # netstat -s        <Show statistics for all ports>
    # netstat -st       <Show statistics for TCP (or) UDP ports>
    # netstat -su

### (-p) Display PID and program names

    # netstat -pt       <Show the PID/Program Name>

### (-n) Disable resolve host

- This will display in numbers, instead of resolving the host name, port name, user name.
- Also speeds up the output, as netstat is not performing any look-up.

### (-c) Auto refresh list

### (--verbose) Find the non supportive Address families in your system

### (-r) Display the kernel routing information

### (-i, -ie) Show the list of network interfaces

## sample output

### netstat -a | more

      Active Internet connections (servers and established)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 localhost:30037         *:*                     LISTEN
      udp        0      0 *:bootpc                *:*

      Active UNIX domain sockets (servers and established)
      Proto RefCnt Flags       Type       State         I-Node   Path
      unix  2      [ ACC ]     STREAM     LISTENING     6135     /tmp/.X11-unix/X0
      unix  2      [ ACC ]     STREAM     LISTENING     5140     /var/run/acpid.socket


    # netstat -at

      Active Internet connections (servers and established)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 localhost:30037         *:*                     LISTEN
      tcp        0      0 localhost:ipp           *:*                     LISTEN
      tcp        0      0 *:smtp                  *:*                     LISTEN
      tcp6       0      0 localhost:ipp           [::]:*                  LISTEN


    # netstat -au

      Active Internet connections (servers and established)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      udp        0      0 *:bootpc                *:*
      udp        0      0 *:49119                 *:*
      udp        0      0 *:mdns                  *:*


### netstat -l

      Active Internet connections (only servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 localhost:ipp           *:*                     LISTEN
      tcp6       0      0 localhost:ipp           [::]:*                  LISTEN
      udp        0      0 *:49119                 *:*
      List only listening TCP Ports using netstat -lt

    # netstat -lt

      Active Internet connections (only servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 localhost:30037         *:*                     LISTEN
      tcp        0      0 *:smtp                  *:*                     LISTEN
      tcp6       0      0 localhost:ipp           [::]:*                  LISTEN
      List only listening UDP Ports using netstat -lu

    # netstat -lu

      Active Internet connections (only servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      udp        0      0 *:49119                 *:*
      udp        0      0 *:mdns                  *:*
      List only the listening UNIX Ports using netstat -lx

    # netstat -lx

      Active UNIX domain sockets (only servers)
      Proto RefCnt Flags       Type       State         I-Node   Path
      unix  2      [ ACC ]     STREAM     LISTENING     6294     private/maildrop
      unix  2      [ ACC ]     STREAM     LISTENING     6203     public/cleanup
      unix  2      [ ACC ]     STREAM     LISTENING     6302     private/ifmail
      unix  2      [ ACC ]     STREAM     LISTENING     6306     private/bsmtp

### netstat -s

      Ip:
          11150 total packets received
          1 with invalid addresses
          0 forwarded
          0 incoming packets discarded
          11149 incoming packets delivered
          11635 requests sent out
      Icmp:
          0 ICMP messages received
          0 input ICMP message failed.
      Tcp:
          582 active connections openings
          2 failed connection attempts
          25 connection resets received
      Udp:
          1183 packets received
          4 packets to unknown port received.
      .....


    ### netstat -p option can be combined with any other netstat option.
    ###   This will add the âPID/Program Nameâ to the netstat output. This is very useful while debugging to identify which program is running on a particular port.

### netstat -pt

      Active Internet connections (w/o servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
      tcp        1      0 ramesh-laptop.loc:47212 192.168.185.75:www        CLOSE_WAIT  2109/firefox
      tcp        0      0 ramesh-laptop.loc:52750 lax:www ESTABLISHED 2109/firefox


    # netstat -an

    ### If you donât want only any one of those three items ( ports, or hosts, or users ) to be resolved, use following commands.
    # netsat -a --numeric-ports
    # netsat -a --numeric-hosts
    # netsat -a --numeric-users


    ### netstat will print information continuously every few seconds.

### netstat -c

      Active Internet connections (w/o servers)
      Proto Recv-Q Send-Q Local Address           Foreign Address         State
      tcp        0      0 ramesh-laptop.loc:36130 101-101-181-225.ama:www ESTABLISHED
      tcp        1      1 ramesh-laptop.loc:52564 101.11.169.230:www      CLOSING
      tcp        0      0 ramesh-laptop.loc:43758 server-101-101-43-2:www ESTABLISHED
      tcp        1      1 ramesh-laptop.loc:42367 101.101.34.101:www      CLOSING
      ^C

    ### Find the non supportive Address families in your system

### netstat --verbose

    At the end, you will have something like this.

    netstat: no support for `AF IPX' on this system.
    netstat: no support for `AF AX25' on this system.
    netstat: no support for `AF X25' on this system.
    netstat: no support for `AF NETROM' on this system.

### netstat -r
Display the kernel routing information using netstat -r

      Kernel IP routing table
      Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface
      192.168.1.0     *               255.255.255.0   U         0 0          0 eth2
      link-local      *               255.255.0.0     U         0 0          0 eth2
      default         192.168.1.1     0.0.0.0         UG        0 0          0 eth2
      Note: Use netstat -rn to display routes in numeric format without resolving for host-names.

### netstat -i
Show the list of network interfaces

      Kernel Interface table
      Iface   MTU Met   RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg
      eth0       1500 0         0      0      0 0             0      0      0      0 BMU
      eth2       1500 0     26196      0      0 0         26883      6      0      0 BMRU
      lo        16436 0         4      0      0 0             4      0      0      0 LRU

    ### Display extended information on the interfaces (similar to ifconfig) using netstat -ie:
    # netstat -ie

      Kernel Interface table
      eth0      Link encap:Ethernet  HWaddr 00:10:40:11:11:11
                UP BROADCAST MULTICAST  MTU:1500  Metric:1
                RX packets:0 errors:0 dropped:0 overruns:0 frame:0
                TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
                collisions:0 txqueuelen:1000
                RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
                Memory:f6ae0000-f6b00000

# ss: a substitution of netstat

    ss -t -a dumps all TCP sockets
    ss -u -a dumps all UDP sockets
    ss -w -a dumps all RAW sockets
    ss -x -a dumps all UNIX sockets

    Option -o shows TCP timers state.
    Option -e shows some extended information.

## filter by socket states

    $ ss (action: state|exclude) <state>

F.e. to dump all tcp sockets except SYN-RECV:

    $ ss exclude SYN-RECV

    - all - for all the states
    - bucket - for TCP minisockets (TIME-WAIT|SYN-RECV)
    - big - all except for minisockets
    - connected - not closed and not listening
    - synchronized - connected and not SYN-SENT

If neither state nor exclude directives are present, state filter defaults to all with option -a or to all, excluding:
listening, syn-recv, time-wait and closed sockets.

some state identifier. abbreviations:

  1. established
  2. syn-sent
  3. syn-recv
  4. fin-wait-1
  5. fin-wait-2
  6. time-wait
  7. closed
  8. close-wait
  9. last-ack
  10. closing
  11. all - All of the above states
  12. connected - All the states except for listen and closed
  13. synchronized - All the connected states except for syn-sent
  14. bucket - Show states, which are maintained as minisockets, i.e. time-wait and syn-recv.
  15. big - Opposite to bucket state.


### Samples

1) List all the tcp sockets in state FIN-WAIT-1 for our apache to network 193.233.7/24 and look at their timers:

    $ ss -o state fin-wait-1 \( sport = :http or sport = :https \) \
                          dst 193.233.7/24

Oops, forgot to say that missing logical operation is equivalent to and.

2) Well, now look at the rest...

    $ ss -o excl fin-wait-1
    $ ss state fin-wait-1 \( sport neq :http and sport neq :https \) \
                       or not dst 193.233.7/24

Note that we have to do `two` calls of ss to do this. State match is always anded to address/port match.
The reason for this is purely technical:
  - ss does fast skip of not matching states before parsing addresses
  - and I consider the ability to skip fastly gobs of time-wait and syn-recv sockets as more important than logical generality.

3) So, let's look at all our sockets using autobound ports:

    $ ss -a -A all autobound

4) And eventually find all the local processes connected to local X servers:

    $ ss -xp dst "/tmp/.X11-unix/*"

Pardon, this does not work with current kernel, patching is required. But we still can look at server side:

    $ ss -x src "/tmp/.X11-unix/*"

# iproute

    # rpm -qf $(which ip)

      iproute-2.6.18-9.el5

ä»æç§æä¹ä¸è¯´ï¼iprouteå·¥å·éå ä¹å¯ä»¥æ¿ä»£ænet-toolså·¥å·éï¼å·ä½çæ¿ä»£æ¹æ¡æ¯è¿æ ·çï¼
```
     ç¨é        net-toolï¼è¢«æ·æ±°ï¼ iproute2
  -----------------------------------------------
  å°ååé¾è·¯éç½® ifconfig           ip-addr,ip-link
  è·¯ç±è¡¨         route              ip-route
  é»å±           arp                ip-neigh
  VLAN           vconfig            ip-link
  é§é           iptunnel           ip-tunnel
  ç»æ­           ipmaddr            ip-maddr
  ç»è®¡           netstat            ss
```

## IP tools

- ip link set--æ¹åè®¾å¤çå±æ§
- ip link show--æ¾ç¤ºè®¾å¤å±æ§
- ip address add--æ·»å ä¸ä¸ªæ°çåè®®å°å
- ip address delete--å é¤ä¸ä¸ªåè®®å°å.
- ip address show--æ¾ç¤ºåè®®å°å
- ip address flush--æ¸é¤åè®®å°å
- ip neighbour show --neighbour/arpè¡¨ç®¡çå½ä»¤
- ip neighbour add -- æ·»å ä¸ä¸ªæ°çé»æ¥æ¡ç®
- ip neighbour change--ä¿®æ¹ä¸ä¸ªç°æçæ¡ç®
- ip neighbour replace--æ¿æ¢ä¸ä¸ªå·²æçæ¡ç®
- ip route show --è·¯ç±
- ip route add -- æ·»å æ°è·¯ç±
- ip route change -- ä¿®æ¹è·¯ç±
- ip route replace -- æ¿æ¢å·²æçè·¯ç±
- ip route flush -- æ¿æ¢å·²æçè·¯ç±
- ip maddress -- å¤æ­å°åç®¡ç,
- ip mroute -- å¤æ­è·¯ç±ç¼å­ç®¡ç
- ip tunnel -- éééç½®
- ip monitorårtmon -- ç¶æçè§

## options

ip [OPTIONS] OBJECT [COMMAND [ARGUMENTS]]

OPTIONSæ¯ä¿®æ¹ipè¡ä¸ºææ¹åå¶è¾åºçéé¡¹ãææçéé¡¹é½æ¯ä»¥-å­ç¬¦å¼å¤´ï¼åä¸ºé¿ãç­ä¸¤ç§å½¢å¼ã

OBJECTæ¯è¦ç®¡çèè·åä¿¡æ¯çå¯¹è±¡ï¼
-V,-Version æå°ipççæ¬å¹¶éåºã
-s,-stats,-statistics è¾åºæ´ä¸ºè¯¦å°½çä¿¡æ¯ãå¦æè¿ä¸ªéé¡¹åºç°ä¸¤æ¬¡æå¤æ¬¡ï¼åè¾åºçä¿¡æ¯å°æ´ä¸ºè¯¦å°½ã
-f,-family è¿ä¸ªéé¡¹åé¢æ¥åè®®ç§ç±»ï¼åæ¬inetãinet6ælinkï¼å¼ºè°ä½¿ç¨çåè®®ç§ç±»ãå¦ææ²¡æè¶³å¤çä¿¡æ¯åè¯ipä½¿ç¨çåè®®ç§ç±»ï¼ipå°±ä¼ä½¿ç¨é»è®¤å¼inetæanyãlinkæ¯è¾ç¹æ®ï¼å®è¡¨ç¤ºä¸æ¶åä»»ä½ç½ç»åè®®ã
-4 æ¯-family inetçç®åã
-6 æ¯-family inet6çç®åã
-0 æ¯-family linkçç®åã
-o,-oneline å¯¹æ¯è¡è®°å½é½ä½¿ç¨åè¡è¾åºï¼åè¡ç¨å­ç¬¦ä»£æ¿ãå¦æéè¦ä½¿ç¨wcãgrepç­å·¥å·å¤çipçè¾åºï¼åä¼ç¨å°è¿ä¸ªéé¡¹ã
-r,-resolve æ¥è¯¢ååè§£æç³»ç»ï¼ç¨è·å¾çä¸»æºåä»£æ¿ä¸»æºIPå°å
COMMAND è®¾ç½®éå¯¹æå®å¯¹è±¡æ§è¡çæä½ï¼å®åå¯¹è±¡çç±»åæå³ã

ä¸è¬æåµä¸ï¼ipæ¯æå¯¹è±¡çå¢å (add)ãå é¤(delete)åå±ç¤º(showælist)ã
å¯¹äºææçå¯¹è±¡ï¼ç¨æ·å¯ä»¥ä½¿ç¨helpå½ä»¤è·å¾å¸®å©ã
å¦ææ²¡ææå®å¯¹è±¡çæä½å½ä»¤ï¼ipä¼ä½¿ç¨é»è®¤çå½ä»¤listï¼æèhelpå½ä»¤ã
ARGUMENTS æ¯å½ä»¤çä¸äºåæ°ï¼å®ä»¬åèµäºå¯¹è±¡åå½ä»¤ã
ipæ¯æä¸¤ç§ç±»åçåæ°ï¼flagåparameterã
flagç±ä¸ä¸ªå³é®è¯ç»æï¼
parameterç±ä¸ä¸ª å³é®è¯å ä¸ä¸ªæ°å¼ç»æã
ä¸ºäºæ¹ä¾¿ï¼æ¯ä¸ªå½ä»¤é½æä¸ä¸ªå¯ä»¥å¿½ç¥çé»è®¤åæ°ãä¾å¦ï¼åæ°devæ¯ip linkå½ä»¤çé»è®¤åæ°ï¼å æ­¤ip link ls eth0ç­äºip link ls dev eth0ã


## ip link show [ DEVICE ]

    # ip link set wlan down
    # ip link set eth0 name wlan            # rename interface
    # ip link set wlan up

## ifconfig

### list detail

    # ifconfig -a   # list all interface

    KVM-125 # sys ifconfig vlan125

    vlan125 Link encap:Ethernet  HWaddr 52:54:00:BD:0C:1C
            inet addr:192.168.17.125  Bcast:192.168.17.255  Mask:255.255.255.0
            UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
            RX packets:176 errors:0 dropped:0 overruns:0 frame:0
            TX packets:131 errors:0 dropped:0 overruns:0 carrier:0
            collisions:0 txqueuelen:1000
            RX bytes:13933 (13.6 KB)  TX bytes:15071 (14.7 KB)

    KVM-125 # dia netlink interface list | grep vlan125 -C6

      if=port_ha family=00 type=1 index=8 mtu=1496 link=0 master=0
      ref=11 state=off start present fw_flags=0 flags=up broadcast multicast

      if=vsys_fgfm family=00 type=772 index=9 mtu=16436 link=0 master=0
      ref=15 state=off start fw_flags=0 flags=up loopback run

      if=vlan125 family=00 type=1 index=11 mtu=1500 link=0 master=0
      ref=15 state=off start fw_flags=0 flags=up broadcast run multicast

### toggle a interface

    # ifconfig eth0 down
    # ifconfig eth0 up

### Assign ip-address

    # ifconfig eth0 192.168.2.2
    # ifconfig eth0 netmask 255.255.255.0
    # ifconfig eth0 broadcast 192.168.2.255
    # ifconfig eth0 mtu 1500

    # ifconfig eth0 192.168.2.2 netmask 255.255.255.0 broadcast 192.168.2.255

### promisc mode

By default when a network card receives a packet,
it checks whether the packet belongs to itself.
If not, the interface card normally drops the packet.
But in promiscuous mode, the card doesnât drop the packet.
Instead, it will accept all the packets which flows through the network card.

Superuser privilege is required to set an interface in promiscuous mode. Most network monitor tools use the promiscuous mode to capture the packets and to analyze the network traffic.

    # ifconfig eth0 promisc     # put the interface in promiscuous mode
    # ifconfig eth0 -promisc    # put the interface in normal mode.

## ip addr

    # ip addr add 192.168.2.77/24 dev lan       #æ·»å ip
    # ip addr show dev lan
    # ip addr flush dev lan                     #æ¸ç©ºç½å¡çææipå°å

### ip address add--æ·»å ä¸ä¸ªæ°çåè®®å°å. ç¼©åï¼addãa

ããç¤ºä¾1ï¼ä¸ºæ¯ä¸ªå°åè®¾ç½®ä¸ä¸ªå­ç¬¦ä¸²ä½ä¸ºæ ç­¾ãä¸ºäºåLinux-2.0çç½ç»å«åå¼å®¹ï¼è¿ä¸ªå­ç¬¦ä¸²å¿é¡»ä»¥è®¾å¤åå¼å¤´ï¼æ¥çä¸ä¸ªåå·ï¼
ãã# ip addr add local 192.168.4.1/28 brd + label eth0:1 dev eth0

ããç¤ºä¾2: å¨ä»¥å¤ªç½æ¥å£eth0ä¸å¢å ä¸ä¸ªå°å192.168.20.0ï¼æ©ç é¿åº¦ä¸º24ä½(155.155.155.0)ï¼æ åå¹¿æ­å°åï¼æ ç­¾ä¸ºeth0:Aliasï¼
ãã# ip addr add 192.168.4.2/24 brd + dev eth1 label eth1:1
ããè¿ä¸ªå½ä»¤ç­äºä¼ ç»ç: ifconfig eth1:1 192.168.4.2

### ip address delete--å é¤ä¸ä¸ªåè®®å°å. ç¼©åï¼deleteãdelãd
ãã# ip addr del 192.168.4.1/24 brd + dev eth0 label eth0:Alias1

### ip address show--æ¾ç¤ºåè®®å°å. ç¼©åï¼showãlistãlstãshãlsãl
ãã# ip addr ls eth0

### ip address flush--æ¸é¤åè®®å°å. ç¼©åï¼flushãf
ããç¤ºä¾1 : å é¤å±äºç§ç½10.0.0.0/8çææå°åï¼
ãã# ip -s -s a f to 10/8

ããç¤ºä¾2 : åæ¶ä»¥å¤ªç½å¡eth0çIPv4å°å
ãã# ip -4 addr flush label "eth0"

## ip neigh

    # ip neigh show	#æ¾ç¤ºipä¸macå¯¹åºå³ç³»
    # ip neigh flush dev lan

# ip route

must enable ip_forward:

    # ip route	#ç¸å½äºroute -n
    # ip route add 192.168.2.0/24 via 192.168.1.1 dev lan	#æ·»å ä¸æ¡è·¯ç±ï¼å»å¾2.0ç½æ®µï¼éè¿lanç½å¡ï¼ä¸ä¸è·³IPä¸º192.168.1.1
    # ip route add 0.0.0.0/0 via 10.10.10.30 dev wan	#æ·»å é»è®¤è·¯ç±
    # ip route add default via 10.10.10.30 dev wan		#æ·»å é»è®¤è·¯ç±
    # ip route del 192.168.2.0/24
    # traceroute www.google.com	#è·¯ç±è¿½è¸ª
    # tracepath www.google.com	#..
    # mtr www.google.com		#å¨æå·æ°è¿½è¸ª


## ECMP(Equal Cost Multipathç­å¼å¤è·¯å¾è·¯ç±)

å½è·¯ç±ä¸æå¤ä¸ªé¾è·¯æ¥å¥æ¶ï¼å¹¶ä¸åæ¶ä½¿ç¨ï¼å¯ä»¥èèECMPææ¯
æ·»å ä¸¤ä¸ªé»è®¤è·¯ç±ï¼ä½¿ç¨rrè°åº¦ç®æ³æ ¹æ®ä¼è¯è½®è¯¢

    # ip route help		#æ¥çå¸®å©
    # ip route add default mpath rr nexthop via 192.168.96.254 dev vmnet1 nexthop via 192.168.203.254 dev vmnet8
    # ip route 		#è¿æ ·å°±ä¼æä¸¤æ¡é»è®¤è·¯ç±äº

    è®¾ç½®æé
    # ip route add default mpath rr nexthop via 192.168.96.254 dev vmnet1 weight 100 nexthop via 192.168.203.254 dev vmnet8 weight 10	#æéæå¤§256


    ### check ip rule
    # ip route list table local	#æåæ¥çè¡¨
    # ip route list table main	#å¹³æ¶æä½çè¡¨
    # ip route list table default


## 1. ç­ç¥è·¯ç±: åºäºæºå°å

æ ¹æ®æºå®¢æ·ç«¯çå­ç½ç½æ®µèµ°åç¸åºçè·¯ç±è·¯å¾
ä¾å¦ï¼éå®é¨é¨ååå¬é¨é¨ï¼è®©éå®é¨é¨äº«å10Må¸¦å®½çº¿è·¯ï¼è®©åå¬é¨é¨äº«å1Må¸¦å®½çº¿è·¯ï¼

### Requirement

- è®©å¬å¸192.168.0.0/24ç½æ®µçå®¢æ·èµ°ç½éè·¯ç±
- 192.168.1.0/24ç½æ®µçèµ°çµä¿¡è·¯ç±

### users
Client1ï¼192.168.0.1
Client2ï¼192.168.1.2
Client3ï¼20.0.0.1

### Gateway (linux PC)

å¯¹åï¼
I1:192.168.0.254	eth0
I2:192.168.1.254	eth0

å¯¹å¤ï¼
E1:202.106.0.21		eth1
E2:202.106.46.152	eth1

### ç½éCNCç½å³
C1:202.106.0.20		eth0
C2:20.0.0.2		    	eth1

### çµä¿¡TELç½å³
T1:202.106.46.151 	eth0
T2:20.0.0.3		         eth1

### Gatewayéç½®ï¼

#### å¢å èªå®ä¹çè·¯ç±è¡¨

    # vi /etc/iproute2/rt_tables
    100 	tab1
    101 	tab2

#### æ·»å è·¯ç±è§å

    # ip route add default via 202.106.0.20 dev eth1 table tab1	#æ·»å é»è®¤è·¯ç±å°è¡¨tab1
    # ip route add default via 202.106.46.151 dev eth1 table tab2	#æ·»å é»è®¤è·¯ç±å°è¡¨tab2
    # ip rule add from 192.168.1.0/24 table tab1			#æ¥èª192.168.1.0/24ç½æ®µçè¯·æ±èµ°tab1è¡¨
    # ip rule add from 192.168.0.0/24 table tab2
    # ip rule
    # ip route add 192.168.1.0/24 dev eth0 table tab1	#æ·»å ç´è¿è·¯ç±ï¼è¥ä¸æ·»å åClient1 ping GWåï¼æ°æ®åä¸è½è¿åï¼å ä¸ºtab1è¡¨ä¸­åªæä¸ä¸ªdefaultè·¯ç±
    # ip route add 192.168.0.0/24 dev eth0 table tab2

### TELéç½®ï¼

    æ·»å å»å¾Client1/2çè·¯ç±
    # ip route add 192.168.0.0/24  via 202.106.46.152 dev eth0
    # ip route add 192.168.1.0/24  via 202.106.46.152 dev eth0

### CNCéç½®ï¼

    æ·»å å»å¾Client1/2çè·¯ç±
    # ip route add 192.168.0.0/24  via 202.106.0.21 dev eth0
    # ip route add 192.168.1.0/24  via 202.106.0.21 dev eth0

### Clientéç½®ï¼

    Client1\2:
    # ip route add default via 192.168.0.254 dev eth0
    # ip route add default via 192.168.1.254 dev eth0

    Client3:
    # ip route add default via 20.0.0.3 dev eth0	#æµè¯ä»ä»TELè·¯å¾è¿åä¹å¯ä»¥åè·¯è¿å
    # ip route add default mpath rr nexthop via 20.0.0.2 dev eth0 nexthop via 20.0.0.3 dev eth0

    Client1\2æµè¯:
    # traceroute 20.0.0.1


## 2. åºäºé²ç«å¢æ è®°çè·¯ç±(firemark)

- å°æ¥èªä¸åipæ®µçæ°æ®åæä¸ä¸åçé²ç«å¢æ è®°ï¼
- æ ¹æ®é²ç«å¢çæ è®°è·¯ç±å°ç¸åºçå°å

### GWéç½®ï¼

    1-100çIPæ è®°ä¸º1ï¼101-253çIPæ è®°ä¸º10
    # iptables -t mangle -A PREROUTING -m iprange --src-range 192.168.1.1-192.168.1.100 -j MARK --set-mark 1
    # iptables -t mangle -A PREROUTING -m iprange --src-range 192.168.1.101-192.168.1.253 -j MARK --set-mark 10

    åæ¸ç©ºä¹åçrule
    # ip rule del from 192.168.1.0/24
    # ip rule del from 192.168.0.0/24

    # ip rule add fwmark 1 pref 1000 table tab1 	#å°æ è®°ä¸º1çåéè³tab1ï¼prefä¸ºä¼åçº§
    # ip rule add fwmark 10 pref 2000 table tab2
    # ip rule
    0:  	from all lookup 255
    1000:		....	tab1
    2000:		....	tab2
    32766:  from all lookup main
    32767:  from all lookup default
    å©ä½åºæ¬åä¸
    # ip route add default via 202.106.0.20 dev eth1 table tab1	#æ·»å é»è®¤è·¯ç±å°è¡¨tab1
    # ip route add default via 202.106.46.151 dev eth1 table tab2
    # ip route add 192.168.1.0/24 dev eth0 table tab1		#æ·»å ç´è¿è·¯ç±
    # ip route add 192.168.0.0/24 dev eth0 table tab2
    ........


## 3. åºäºç®çå°åç­ç¥è·¯ç±

æ ¹æ®è®¿é®çç®æ å°åè¿åï¼è®¿é®ç½éçIPæ®µèµ°CNCï¼è®¿é®çµä¿¡çèµ°TEL

### GWéç½®ï¼

    å é¤è§å
    # iptables -F -t mangle
    # ip rule del fwmark 1 pref 1000 table tab1
    # ip rule del fwmark 10 pref 2000 table tab2

    # ip rule add to 20.0.0.1 table tab2
    # ip rule add to 20.0.0.4 table tab1
    # ip rule

    å¶ä½éç½®åä¸

    Client1\2æµè¯:
    # traceroute 20.0.0.1
    # traceroute 20.0.0.4

åå¦è®¿é®æè²ç½æå½å¤ç½ç»ï¼å¯ä»¥å¨mainè¡¨ä¸­æ·»å ä¸æ¡é»è®¤çè·¯ç±


# ip link

## ip link set--æ¹åè®¾å¤çå±æ§. ç¼©åï¼setãs

ããç¤ºä¾1ï¼up/down èµ·å¨ï¼å³é­è®¾å¤ã
ãã# ip link set dev eth0 up
ããè¿ä¸ªç­äºä¼ ç»ç # ifconfig eth0 up(down)

ããç¤ºä¾2ï¼æ¹åè®¾å¤ä¼ è¾éåçé¿åº¦ã
ããåæ°:txqueuelen NUMBERæètxqlen NUMBER
ãã# ip link set dev eth0 txqueuelen 100

ããç¤ºä¾3ï¼æ¹åç½ç»è®¾å¤MTU(æå¤§ä¼ è¾åå)çå¼ã
ãã# ip link set dev eth0 mtu 1500

ããç¤ºä¾4ï¼ ä¿®æ¹ç½ç»è®¾å¤çMACå°åã
ããåæ°: address LLADDRESS
ãã# ip link set dev eth0 address 00:01:4f:00:15:f1

## ip link show--æ¾ç¤ºè®¾å¤å±æ§. ç¼©åï¼showãlistãlstãshãlsãl
ãã-séé¡¹åºç°ä¸¤æ¬¡æèæ´å¤æ¬¡ï¼ipä¼è¾åºæ´ä¸ºè¯¦ç»çéè¯¯ä¿¡æ¯ç»è®¡ã

ããç¤ºä¾:
ãã# ip -s -s link ls eth0
ããè¿ä¸ªå½ä»¤ç­äºä¼ ç»ç ifconfig eth0

6. ip neighbour--neighbour/arpè¡¨ç®¡çå½ä»¤
ããç¼©å neighbourãneighborãneighãn
ããå½ä»¤ addãchangeãreplaceãdeleteãfulshãshow(æèlist)
ããç¼©åï¼addãaï¼changeãchgï¼replaceãrepl

ããip neighbour add -- æ·»å ä¸ä¸ªæ°çé»æ¥æ¡ç®
ããip neighbour change--ä¿®æ¹ä¸ä¸ªç°æçæ¡ç®
ããip neighbour replace--æ¿æ¢ä¸ä¸ªå·²æçæ¡ç®

ããç¤ºä¾1: å¨è®¾å¤eth0ä¸ï¼ä¸ºå°å10.0.0.3æ·»å ä¸ä¸ªpermanent ARPæ¡ç®ï¼
ãã# ip neigh add 10.0.0.3 lladdr 0:0:0:0:0:1 dev eth0 nud perm

ããç¤ºä¾2:æç¶ææ¹ä¸ºreachable
ãã# ip neigh chg 10.0.0.3 dev eth0 nud reachable

ããç¤ºä¾1:å é¤è®¾å¤eth0ä¸çä¸ä¸ªARPæ¡ç®10.0.0.3
ãã# ip neigh del 10.0.0.3 dev eth0

   ip neighbour show--æ¾ç¤ºç½ç»é»å±çä¿¡æ¯. ç¼©åï¼showãlistãshãls
ããç¤ºä¾1: # ip -s n ls 193.233.7.254
ãã     193.233.7.254. dev eth0 lladdr 00:00:0c:76:3f:85 ref 5 used 12/13/20 nud reachable

ããip neighbour flush--æ¸é¤é»æ¥æ¡ç®. ç¼©åï¼flushãf
ããç¤ºä¾1: (-s å¯ä»¥æ¾ç¤ºè¯¦ç»ä¿¡æ¯)
ãã# ip -s -s n f 193.233.7.254

7. è·¯ç±è¡¨ç®¡ç, ç¼©å routeãroãr

ããåæ ¸æè·¯ç±å½çº³å°è®¸å¤è·¯ç±è¡¨ä¸­ï¼è¿äºè¡¨é½è¿è¡äºç¼å·ï¼ç¼å·æ°å­çèå´æ¯1å°255ãå¦å¤ï¼ä¸ºäºæ¹ä¾¿ï¼è¿å¯ä»¥å¨/etc/iproute2/rt_tablesä¸­ä¸ºè·¯ç±è¡¨å½åã
ããé»è®¤æåµä¸ï¼ææçè·¯ç±é½ä¼è¢«æå¥å°è¡¨main(ç¼å·254)ä¸­ãå¨è¿è¡è·¯ç±æ¥è¯¢æ¶ï¼åæ ¸åªä½¿ç¨è·¯ç±è¡¨mainã

ããip route add -- æ·»å æ°è·¯ç±
ããip route change -- ä¿®æ¹è·¯ç±
ããip route replace -- æ¿æ¢å·²æçè·¯ç±
ãã    ç¼©åï¼addãaï¼changeãchgï¼replaceãrepl

ããç¤ºä¾0: æ·»å ç¼ºçè·¯ç±
ãã# ip route add default via 192.168.1.254
ãã# ip route change default via 192.168.99.113

ããç¤ºä¾1: è®¾ç½®å°ç½ç»10.0.0/24çè·¯ç±ç»è¿ç½å³193.233.7.65
ãã# ip route add 10.0.0/24 via 193.233.7.65

ããç¤ºä¾2: ä¿®æ¹å°ç½ç»10.0.0/24çç´æ¥è·¯ç±ï¼ä½¿å¶ç»è¿è®¾å¤dummy
ãã# ip route chg 10.0.0/24 dev dummy

ããç¤ºä¾3: å®ç°é¾è·¯è´è½½å¹³è¡¡.å å¥ç¼ºçå¤è·¯å¾è·¯ç±ï¼è®©ppp0åppp1åæè´è½½(æ³¨æï¼scopeå¼å¹¶éå¿éï¼å®åªä¸è¿æ¯åè¯åæ ¸ï¼è¿ä¸ªè·¯ç±è¦ç»è¿ç½å³èä¸æ¯ç´è¿çãå®éä¸ï¼å¦æä½ ç¥éè¿ç¨ç«¯ç¹çå°åï¼ä½¿ç¨viaåæ°æ¥è®¾ç½®å°±æ´å¥½äº)ã
ãã# ip route add default scope global nexthop dev ppp0 nexthop dev ppp1
ãã# ip route replace default scope global nexthop dev ppp0 nexthop dev ppp1

ããç¤ºä¾4: è®¾ç½®NATè·¯ç±ãå¨è½¬åæ¥èª192.203.80.144çæ°æ®åä¹åï¼åè¿è¡ç½ç»å°åè½¬æ¢ï¼æè¿ä¸ªå°åè½¬æ¢ä¸º193.233.7.83
ãã# ip route add nat 192.203.80.142 via 193.233.7.83

ããç¤ºä¾5: å®ç°æ°æ®åçº§è´è½½å¹³è¡¡,åè®¸ææ°æ®åéæºä»å¤ä¸ªè·¯ç±ååºãweight å¯ä»¥è®¾ç½®æé.
   # ip route replace default equalize nexthop via 211.139.218.145 dev eth0 weight 1 nexthop via 211.139.218.145 dev eth1 weight 1

ããip route delete-- å é¤è·¯ç±, ç¼©åï¼deleteãdelãd

ããç¤ºä¾1:å é¤ä¸ä¸èå½ä»¤å å¥çå¤è·¯å¾è·¯ç±
ãã# ip route del default scope global nexthop dev ppp0 nexthop dev ppp1

ããip route show -- ååºè·¯ç±, ç¼©åï¼showãlistãshãlsãl
ããç¤ºä¾1: è®¡ç®ä½¿ç¨gated/bgpåè®®çè·¯ç±ä¸ªæ°
ãã# ip route ls proto gated/bgp |wc

ããç¤ºä¾2: è®¡ç®è·¯ç±ç¼å­éé¢çæ¡æ°ï¼ç±äºè¢«ç¼å­è·¯ç±çå±æ§å¯è½å¤§äºä¸è¡ï¼ä»¥æ­¤éè¦ä½¿ç¨-oéé¡¹
ãã# ip -o route ls cloned |wc

ããç¤ºä¾3: ååºè·¯ç±è¡¨TABLEIDéé¢çè·¯ç±ãç¼ºçè®¾ç½®æ¯table mainãTABLEIDæèæ¯ä¸ä¸ªçæ­£çè·¯ç±è¡¨IDæèæ¯/etc/iproute2/rt_tablesæä»¶å®ä¹çå­ç¬¦ä¸²ï¼
ããæèæ¯ä»¥ä¸çç¹æ®å¼ï¼
	ããall -- ååºææè¡¨çè·¯ç±ï¼
	ããcache -- ååºè·¯ç±ç¼å­çåå®¹ã
ãã        ip ro ls 193.233.7.82 tab cache

ããç¤ºä¾4: ååºæä¸ªè·¯ç±è¡¨çåå®¹
ãã# ip route ls table fddi153

ããç¤ºä¾5: ååºé»è®¤è·¯ç±è¡¨çåå®¹
ãã# ip route ls
ããè¿ä¸ªå½ä»¤ç­äºä¼ ç»ç: route

ããip route flush -- æ¦é¤è·¯ç±è¡¨

ããç¤ºä¾1: å é¤è·¯ç±è¡¨mainä¸­çææç½å³è·¯ç±ï¼ç¤ºä¾ï¼å¨è·¯ç±çæ§ç¨åºææä¹åï¼ï¼
ãã# ip -4 ro flush scope global type unicast

ããç¤ºä¾2:æ¸é¤ææè¢«åéåºæ¥çIPv6è·¯ç±ï¼
ãã# ip -6 -s -s ro flush cache

ããç¤ºä¾3: å¨gatedç¨åºææä¹åï¼æ¸é¤ææçBGPè·¯ç±ï¼
ãã# ip -s ro f proto gated/bgp

ããç¤ºä¾4: æ¸é¤ææipv4è·¯ç±cache
ãã# ip route flush cache

ããip route get -- è·å¾åä¸ªè·¯ç± .ç¼©åï¼getãg
ããä½¿ç¨è¿ä¸ªå½ä»¤å¯ä»¥è·å¾å°è¾¾ç®çå°åçä¸ä¸ªè·¯ç±ä»¥åå®çç¡®ååå®¹ã
ããip route getå½ä»¤åip route showå½ä»¤æ§è¡çæä½æ¯ä¸åçã
ããip route showå½ä»¤åªæ¯æ¾ç¤ºç°æçè·¯ç±ï¼èip route getå½ä»¤å¨å¿è¦æ¶ä¼æ´¾çåºæ°çè·¯ç±ã

ããç¤ºä¾1: æç´¢å°193.233.7.82çè·¯ç±
ãã# ip route get 193.233.7.82
ãã    193.233.7.82 dev eth0 src 193.233.7.65 realms inr.ac cache mtu 1500 rtt 300

ããç¤ºä¾2: æç´¢ç®çå°åæ¯193.233.7.82ï¼æ¥èª193.233.7.82ï¼ä»eth0è®¾å¤å°è¾¾çè·¯ç±ï¼è¿æ¡å½ä»¤ä¼äº§çä¸æ¡éå¸¸æææçè·¯ç±ï¼è¿æ¯ä¸æ¡å°193.233.7.82çåç¯è·¯ç±ï¼
ãã# ip r g 193.233.7.82 from 193.233.7.82 iif eth0
ãã    193.233.7.82 from 193.233.7.82 dev eth0 src 193.233.7.65 realms inr.ac/inr.ac
ãã    cache <src-direct,redirect> mtu 1500 rtt 300 iif eth0

8. ip route -- è·¯ç±ç­ç¥æ°æ®åºç®¡çå½ä»¤

ããaddãdeleteãshow(æèlist)
ããæ³¨æï¼ç­ç¥è·¯ç±(policy routing)ä¸ç­äºè·¯ç±ç­ç¥(rouing policy)ã
ããå¨æäºæåµä¸ï¼æä»¬ä¸åªæ¯éè¦éè¿æ°æ®åçç®çå°åå³å®è·¯ç±ï¼å¯è½è¿éè¦éè¿å¶ä»ä¸äºåï¼æºå°åãIPåè®®ãä¼ è¾å±ç«¯å£çè³æ°æ®åçè´è½½ã
ããè¿å°±å«åï¼ç­ç¥è·¯ç±(policy routing)ã

   ip rule add -- æå¥æ°çè§å
   ip rule delete -- å é¤è§å
ããç¼©åï¼addãaï¼deleteãdelãd

ããç¤ºä¾1: éè¿è·¯ç±è¡¨inr.ruhepè·¯ç±æ¥èªæºå°åä¸º192.203.80/24çæ°æ®å
ããip ru add from 192.203.80/24 table inr.ruhep prio 220

ããç¤ºä¾2:ææºå°åä¸º193.233.7.83çæ°æ®æ¥çæºå°åè½¬æ¢ä¸º192.203.80.144ï¼å¹¶éè¿è¡¨1è¿è¡è·¯ç±
ããip ru add from 193.233.7.83 nat 192.203.80.144 table 1 prio 320

ããç¤ºä¾3:å é¤æ ç¨çç¼ºçè§å
ããip ru del prio 32767

ããip rule show -- ååºè·¯ç±è§å, ç¼©åï¼showãlistãshãlsãl

ããç¤ºä¾1: # ip ru ls
	ãã0: from all lookup local
	ãã32762: from 192.168.4.89 lookup fddi153
	ãã32764: from 192.168.4.88 lookup fddi153
	ãã32766: from all lookup main
	ãã32767: from all lookup 253

9. ip maddress -- å¤æ­å°åç®¡ç, ç¼©åï¼showãlistãshãlsãl

ããip maddress show -- ååºå¤æ­å°å
ããç¤ºä¾1: # ip maddr ls dummy

ããip maddress add -- å å¥å¤æ­å°å
ããip maddress delete -- å é¤å¤æ­å°å, ç¼©åï¼addãaï¼deleteãdelãd
ããä½¿ç¨è¿ä¸¤ä¸ªå½ä»¤ï¼æä»¬å¯ä»¥æ·»å ï¼å é¤å¨ç½ç»æ¥å£ä¸çå¬çé¾è·¯å±å¤æ­å°åãè¿ä¸ªå½ä»¤åªè½ç®¡çé¾è·¯å±å°åã

ããç¤ºä¾1: å¢å  # ip maddr add 33:33:00:00:00:01 dev dummy
ããç¤ºä¾2: æ¥ç # ip -O maddr ls dummy
	ãã2: dummy
	ããlink 33:33:00:00:00:01 users 2 static
	ããlink 01:00:5e:00:00:01

ããç¤ºä¾3: å é¤
ãã# ip maddr del 33:33:00:00:00:01 dev dummy
ãã
10.ip mroute -- å¤æ­è·¯ç±ç¼å­ç®¡ç

ããip mroute show -- ååºå¤æ­è·¯ç±ç¼å­æ¡ç®, ç¼©åï¼showãlistãshãlsãl

ããç¤ºä¾1:æ¥ç # ip mroute ls
	ãã(193.232.127.6, 224.0.1.39) Iif: unresolved
	ãã(193.232.244.34, 224.0.1.40) Iif: unresolved
	ãã(193.233.7.65, 224.66.66.66) Iif: eth0 Oifs: pimreg

ããç¤ºä¾2:æ¥ç
ãã# ip -s mr ls 224.66/16

11. ip tunnel -- éééç½®, ç¼©åtunnelãtunl

ããip tunnel add -- æ·»å æ°çéé
ããip tunnel change -- ä¿®æ¹ç°æçéé
ããip tunnel delete -- å é¤ä¸ä¸ªéé
ããç¼©åï¼addãaï¼changeãchgï¼deleteãdelãd

ããç¤ºä¾1:å»ºç«ä¸ä¸ªç¹å¯¹ç¹ééï¼æå¤§TTLæ¯32
ãã# ip tunnel add Cisco mode sit remote 192.31.7.104 local 192.203.80.1 ttl 32
ããip tunnel show -- ååºç°æçéé, ç¼©åï¼showãlistãshãlsãl
ããç¤ºä¾1: # ip -s tunl ls Cisco

12. ip monitorårtmon -- ç¶æçè§
ããipå½ä»¤å¯ä»¥ç¨äºè¿ç»­å°çè§è®¾å¤ãå°ååè·¯ç±çç¶æãè¿ä¸ªå½ä»¤éé¡¹çæ ¼å¼æç¹ä¸åï¼å½ä»¤éé¡¹çåå­å«åmonitorï¼æ¥çæ¯æä½å¯¹è±¡ï¼

ããip monitor [ file FILE ] [ all | OBJECT-LIST ]
ããç¤ºä¾1: # rtmon file /var/log/rtmon.log
ããç¤ºä¾2: # ip monitor file /var/log/rtmon.log r


# Howtos

## vlan

    $ sudo ip link add link eth0 name vlan125 type vlan id 125
    $ sudo ip addr add 192.168.17.122/24 dev vlan125
    $ sudo ip route change default via 192.168.17.125
    $ ip route list
    $ ping 192.168.17.125
    $ ping 8.8.8.8


  [1]: http://www.cyberciti.biz/files/ss.html
  [2]: http://www.binarytides.com/linux-ss-command/
  [6]: https://networkengineering.stackexchange.com/questions/14965/icmp-redirect-static-routing
